# hol_club bot

## Что умеет бот (по назначению)

### Пользователь
- Обязательная анкета при первом входе (пол, возраст).
- Редактирование профиля (пол, возраст).
- Вступление в чаты событий по ссылке/кнопке с учетом пола и возраста.

### Партнер
- Создание события (название, фото опционально, дата/время, адрес, описание, цена опционально, возрастная группа опционально).
- Публикация события в канал и создание приватного чата события.
- Просмотр списка своих событий и деталей.

### Администратор
- Просмотр списка заявок на партнерство.
- Одобрение/отклонение заявок.

### Рекламная регистрация
- Регистрация по спец-payload в /start с записью статистики по рекламе.

## Авторизация Telethon

Для создания приватных чатов событий нужно один раз авторизовать user-сессию Telegram:

1. Заполнить в `.env`:
   - `TELETHON_API_ID`
   - `TELETHON_API_HASH`
   - `TELETHON_SESSION` (например `hol_club_telethon`)
2. Выполнить:
   - `poetry run python scripts/auth_telethon.py`
3. Ввести телефон, код из Telegram и пароль 2FA (если включен).

## Adv.Cake интеграция (покупка билетов)

Бот поддерживает автоматическое подтверждение покупок через Adv.Cake (без webhook, через polling XML).

### Переменные окружения

Добавьте в `.env`:

```
ADVCake__API_KEY=your_advcake_api_key
ADVCake__POLL_INTERVAL_SECONDS=600
ADVCake__DAYS=2
```

### Как это работает

1. Администратор при создании события указывает ссылку на билет (Adv.Cake).
2. Пользователь нажимает «Купить билет» → бот выдает персональную ссылку с `sub1=e{event_id}u{telegram_id}`.
3. Poller раз в 10 минут получает XML‑заказы из Adv.Cake и при статусе `2` (одобрен) автоматически выдает доступ в приватный чат.
